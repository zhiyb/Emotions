SRC	?= $(wildcard *.jpg) $(wildcard *.png)
DIR	?= telegram
OUT	?= $(SRC:%=$(DIR)/%.png)

MIN	?= 256

SHELL	:= /bin/bash

.PHONY: all
all: $(OUT)

.PHONY: clean
clean:
	rm -f $(OUT)

$(DIR):
	mkdir -p $@

.DELETE_ON_ERROR:

$(DIR)/%.png: % | $(DIR)
	convert "$<" -interpolate nearest -filter point -resize "$$(identify -format '%[fx:max(1,floor(min($(MIN)/w,$(MIN)/h)))]00%' "$<")" -size 512x1 xc:transparent -background transparent -layers merge -resize 512x512 "$@"
